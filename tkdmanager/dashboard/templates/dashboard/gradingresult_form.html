{% extends "base_generic.html" %}

{% block content %}
<h4>Add Grading Details</h4>
<form action="" method="post">
  {% csrf_token %}
  <table>
    {{ form.as_table }}
  </table>
  <input type="submit" value="Submit" />
  <!-- Add this script after the jQuery script -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script>
  $(document).ready(function() {
      // Function to update grading_invite options based on the selected member
      function updateGradingInviteOptions() {
          var selectedMember = $('#id_member').val();  // Assuming 'id_member' is the ID of the member field
          var gradingInviteField = $('#id_grading_invite');  // Assuming 'id_grading_invite' is the ID of the grading_invite field
  
          // Make an AJAX request to fetch the filtered grading invites
          $.ajax({
              url: '/dashboard/member/' + selectedMember + '/get_grading_invites/',  // Replace with the actual URL to your filtering view
              dataType: 'json',
              success: function(data) {
                  // Clear existing options and add new options
                  gradingInviteField.empty();
                  $.each(data, function(index, option) {
                      gradingInviteField.append($('<option>', {
                          value: option.value,
                          text: option.label
                      }));
                  });
              },
              error: function(xhr, status, error) {
                  console.error('Error fetching grading invites:', error);
                  // Handle error, e.g., display a message to the user
              }
          });
      }
  
      // Bind the function to the change event of the member field
      $('#id_member').change(updateGradingInviteOptions);
  
      // Trigger the function on page load if a member is pre-selected (e.g., during editing)
      updateGradingInviteOptions();
  });
  </script>
  
</form>
{% endblock %}