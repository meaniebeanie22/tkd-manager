{% extends "base_generic.html" %}

{% block content %}
<h4>Add a Grading Invite</h4>
<form action="" method="post">
  {% csrf_token %}
  <table>
    {{ form.as_table }}
    <script src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
    {{ form.media }}
  </table>
  <input type="submit" value="Submit" />
   <!-- Add this script after the jQuery script -->
   <script>
   $(document).ready(function() {
       // Function to update grading_invite options based on the selected member
       function updatePaymentOptions() {
           var selectedMember = $('#id_member').val();  // Assuming 'id_member' is the ID of the member field
           var paymentField = $('#id_payment');  // Assuming 'id_grading_invite' is the ID of the grading_invite field
   
           // Make an AJAX request to fetch the filtered grading invites
           $.ajax({
               url: '/dashboard/member/' + selectedMember + '/get_payments/',  // Replace with the actual URL to your filtering view
               dataType: 'json',
               success: function(data) {
                   // Clear existing options and add new options
                   paymentField.empty();
                   $.each(data, function(index, option) {
                       paymentField.append($('<option>', {
                           value: option.value,
                           text: option.label
                       }));
                   });
               },
               error: function(xhr, status, error) {
                   console.error('Error fetching grading invites:', error);
                   // Handle error, e.g., display a message to the user
               }
           });
       }
   
       // Bind the function to the change event of the member field
       $('#id_member').change(updatePaymentOptions);
   
       // Trigger the function on page load if a member is pre-selected (e.g., during editing)
   });
   </script>
</form>
{% endblock %}